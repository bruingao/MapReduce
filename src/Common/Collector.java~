package Common;

import java.util.*;


/**
 * Collector is a utility class to collect key value pairs 
 * generated by user mapper/reducer classes. It is able to
 * the collected pairs according to key.
 *
 * @author      Rui Zhang
 * @author      Jing Gao
 * @version     1.0, 11/12/2013
 * @since       1.0
 */
public class Collector {

    
    public List<Pair> collection=new ArrayList<Pair>();
    public HashSet<Object> uniqueKeys= new HashSet<Object>();
    
    /** 
     * constructor of DataNode class
     * 
     * @since           1.0
     */
    public Collector()
    {
        
    }
    
    /** 
     * add list of kv pairs to collection, record unique keys
     * 
     * @param kvPairs       the list of kv pairs
     * @since               1.0
     */
    public void addkvPairs(List<Pair> kvPairs){
        collection.addAll(kvPairs);
        for (int i=0;i<kvPairs.size();i++){
            uniqueKeys.add(kvPairs.get(i).name);
        }
    }
    
    /** 
     * add a kv pair to collection, record unique keys
     * 
     * @param kvPair        the kv pair
     * @since               1.0
     */
    public void addkvPair(Pair kvPair){
        collection.add(kvPair);
        uniqueKeys.add(kvPair.name);
    }
    
    /** 
     * add a kv pair of object to collection
     * 
     * @param key       the object key in the pair
     * @since           the object value in the pair
     */
    public void collect(Object key, Object value) {
        Pair pair = new Pair(key, value);
        addkvPair(pair);
    }
    
    /** 
     * sort collection according to key, taking key as String
     * 
     * @since               1.0
     */
    public void sortStringKey(){
        Collections.sort(this.collection, new stringKeyComparator());
    }
    
    /** 
     * sort collection according to key, taking key as integer
     * 
     * @since               1.0
     */
    public void sortIntKey(){
        Collections.sort(this.collection, new intKeyComparator());
    }
    
    public class stringKeyComparator implements Comparator<Pair> {
        public int compare(Pair kvPair1, Pair kvPair2) {
            if (((String) kvPair1.name).hashCode() > ((String) kvPair2.name).hashCode()){
                return 1;
            } else {
                return -1;
            }
        }
    }
    
    public class intKeyComparator implements Comparator<Pair> {
        public int compare(Pair kvPair1, Pair kvPair2) {
            if (Integer.parseInt((String)kvPair1.name)>Integer.parseInt((String)kvPair2.name)){
                return 1;
            } else {
                return -1;
            }
        }
    }
    
    

}
